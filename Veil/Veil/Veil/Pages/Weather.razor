@page "/weather"
@using Newtonsoft.Json
@using ThirdPartyApis
@inject IJSRuntime JS

<PageTitle>Veil | Weather</PageTitle>


<MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
    <MudTabPanel Text="Map">
        <MudTextField @bind-Value="Latitude" Label="Standard" Variant="Variant.Text" id="latitudeText"></MudTextField>
        <MudTextField @bind-Value="Longitude" Label="Standard" Variant="Variant.Text" id="longitudeText"></MudTextField>



        <MudPaper Elevation="2" Height="80vh">
            <div id="map">
            </div>
        </MudPaper>

    </MudTabPanel>
    <MudTabPanel Text="Weather" OnClick="ButtonOnClick">


        @if (weatherResults is not null)
        {

        <WeatherChart SeriesElement1Label="Tempurature °C" YAxisLabel="Tempurature °C" XAxisLabel="Time (HH)" SeriesElement1="weatherResults.hourly.temperature_2m.Cast<object>().ToList()"></WeatherChart>
        }



        <MudGrid>
    <MudItem xs="12">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=12</MudPaper>
    </MudItem>
    <MudItem xs="6">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=6</MudPaper>
    </MudItem>
    <MudItem xs="6">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=6</MudPaper>
    </MudItem>
    <MudItem xs="3">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=3</MudPaper>
    </MudItem>
    <MudItem xs="3">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=3</MudPaper>
    </MudItem>
    <MudItem xs="3">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=3</MudPaper>
    </MudItem>
    <MudItem xs="12">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8 px-8">

            <WeatherChart></WeatherChart>
        </MudPaper>
    </MudItem>
</MudGrid>


    </MudTabPanel>
    <MudTabPanel Text="Tab Three">
        <MudText>Content Three</MudText>
    </MudTabPanel>
    <MudTabPanel Text="Tab Disabled" Disabled="true">
        <MudText>Content Disabled</MudText>
    </MudTabPanel>
</MudTabs>


@code {
    public double Latitude { get; set; } = 0.0;
    public double Longitude { get; set; } = 0.0;

    public ForecastResult? weatherResults { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(firstRender) {
            await JS.InvokeVoidAsync("InitMap");
        }
    }

    async void ButtonOnClick()
    {
        var forecast = await Services.Weather.GetTodaysWeather(Latitude, Longitude);
        weatherResults = forecast;
    }
}

