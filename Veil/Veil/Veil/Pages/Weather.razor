@page "/weather"
@using Newtonsoft.Json
@using ThirdPartyApis
@using Veil.Data.Weather
@using Veil.Services
@inject IJSRuntime JS

<PageTitle>Veil | Weather</PageTitle>



        @if (weatherService != null && weatherService.ForecastResult != null)
        {
        <WeatherChart             
            YAxisLabel="Weather at Current Location"
            XAxisLabel="Time (HH)"
            SeriesElement1Label="@TempuratureChartLabel"
            SeriesElement1="weatherService.ForecastResult.hourly.temperature_2m.Cast<object>().ToList()"

            SeriesElement2Label="Apparent Tempurature"
            SeriesElement2="weatherService.ForecastResult.hourly.apparent_temperature.Cast<object>().ToList()"
            
            SeriesElement3Label="Precipation"
            SeriesElement3="weatherService.ForecastResult.hourly.precipitation.Cast<object>().ToList()"
        ></WeatherChart>
        }


        <MudGrid>
    <MudItem xs="12">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">
            
        </MudPaper>
    </MudItem>
    <MudItem xs="6">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">
        </MudPaper>
    </MudItem>
    <MudItem xs="6">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=6</MudPaper>
    </MudItem>
    <MudItem xs="3">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=3</MudPaper>
    </MudItem>
    <MudItem xs="3">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=3</MudPaper>
    </MudItem>
    <MudItem xs="3">
        <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">xs=3</MudPaper>
    </MudItem>
</MudGrid>



@code {
    public double Latitude { get; set; }
    public double Longitude { get; set; }
    public WeatherService weatherService { get; set; }

    public string TempuratureChartLabel { get; set; } = String.Empty;



    protected override async Task OnParametersSetAsync()
    {
        Latitude = await Util.Geolocation.GetLatitude(JS);
        Longitude = await Util.Geolocation.GetLongitude(JS);
        weatherService = new WeatherService(Latitude, Longitude);

        TempuratureChartLabel = $"Tempurature °C ({Latitude}, {Longitude})";

            foreach (WeatherCode o in weatherService.HourlyWeatherCodes)
            {
            Console.WriteLine(o.Description);
            }

    }
}

